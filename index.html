<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>PC Sleep</title>

    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel='stylesheet' type='text/css' media='screen' href='main.css'>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@500&display=swap" rel="stylesheet">
    <link rel="shortcut icon" href="./images/favicon.ico" />
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
    <script src="./Backend/dist/easytimer.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</head>

<body>
<div class="container">  
    <div class="main"> <br>  <br/>  <br/>
        <div class="title">
            <h1> PC Sleep </h1>
        </div>  

        <h3 id="subtitle">Insira o tempo para o computador desligar abaixo</h3> <br/>  <br/>

        <div class="timeFormContainer">

            <div class="form-outline timeFormContainer" style="width: 22rem;">

                <div class="wrapper">
                    <input id = "hoursForm" min="0" max="" type="number" onPaste="return false" id="typeNumber" placeholder="hora" class="form-control" />
                    <div class="placeholder">hora</div>
                </div>

                <div class="wrapper" style="margin-right: 5px; margin-left: 5px;">
                    <input id = "minutesForm" min="0" max="59" type="number"  onPaste="return false" id="typeNumber" placeholder="min" class="form-control"  />
                    <div class="placeholder">min</div>
                </div>
                
                <div class="wrapper">
                    <input id = "secondsForm" min="0" max="59" type="number" onPaste="return false" id="typeNumber" placeholder="seg" class="form-control" />
                    <div class="placeholder">seg</div>
                </div>
            
            </div>

            <!-- <input id = "hoursForm" class = "timeForm" value="00" placeholder="" type="number" min="0" max="99"></input>  <br/>
            <input id = "minutesForm" class = "timeForm" value="30" placeholder="" type="number" min="0" max="59"></input>  <br/>
            <input id = "secondsForm" class = "timeForm" value="00" placeholder="" type="number" min="0" max="59"></input>  <br/> -->
            <br/>
        </div>

        <br/>  <br/>

        <div class="buttonsSections">
            <button id = "shutdownButton" class="btn btn-primary"> Desligar </button> 
            
            <button id = "restartButton" class="btn btn-warning"> Reiniciar </button> <br/>  <br/> 
        </div> 

        <button id = "cancelShutdownButton" disabled class="btn btn-danger"> Cancelar </button>  
        
        <div> <br/> 
            <p id = "shutdownInformation"></p>
        </div>

        <svg data-bs-toggle="modal" data-bs-target="#presetModal" xmlns="http://www.w3.org/2000/svg" style="cursor: pointer;" width="16" height="16" fill="currentColor" class="bi bi-three-dots" viewBox="0 0 16 16">
            <path d="M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"/>
            </svg>

    </div>
</div>

<!-- Button trigger modal -->
<!-- <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#presetModal">
Tempo predefino
</button> -->

<!-- Modal -->
<div class="modal fade" id="presetModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
        <div class="modal-header">

            <div class="row">
                <h5 class="modal-title" id="modalTitle">Tempo predefinido</h5>
            </div>
            </button>
        </div>
        <div class="modal-body"> 
            
            <h5 id="subtitle">Selecione um tempo predefinido para criar o agendamento.</h5> <br>

            <div class="row">
        
            <div class="row">
                <div class="col">
                <button id = "" onclick="runPreset(10)" class="btn btn-primary" data-bs-dismiss="modal"> 10 min </button> 
                </div>
                <div class="col">
                <button id = "" onclick="runPreset(30)" class="btn btn-primary" data-bs-dismiss="modal"> 30 min </button> 
                </div>
                <div class="col">
                <button id = "" onclick="runPreset(1)" class="btn btn-primary" data-bs-dismiss="modal"> 1 hora </button> 
                </div>
            </div> <br> <br> <br>

            <div class="modal-footer">
                <!-- <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button> --> <br>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div> 
</body>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

<script>

let actionInProgress = false;

/*Função para desligar o pc*/
async function shutdown(){

    var hour = document.getElementById('hoursForm').value;
    var min = document.getElementById('minutesForm').value;
    var sec = document.getElementById('secondsForm').value;
    actionInProgress = true;

    const timeToShutdown = hour * 3600 + min * 60 + sec * 1;

    if(hour == undefined || hour.length == 0 || min == undefined || min.length == 0 || sec == undefined || sec.length == 0){
            Toastify({
            text: "Atenção: Informe o tempo para desligar",
            className: "info",
            style: {
                background: "yellow",
                color: "black"
            }
            }).showToast();
    } else {

        
        console.log(actionInProgress)
        await axios({
                method: 'get',
                url: `http://localhost:8080/shutdown/${timeToShutdown}`,
                })
                .then(function (response) {
                    
                    const shutdownInformation = document.getElementById('shutdownInformation');
                    document.getElementById("cancelShutdownButton").disabled = false;

                        var updatedSec = sec;
                        var updatedMin = min;
                        var updatedHour = hour;

                        var interval = setInterval( decrement, 1000);

                        function decrement(){

                            if(updatedSec > 0) {
                                updatedSec = updatedSec - 1;
                                
                                shutdownInformation.innerHTML = `Será desligado em ${hour}h ${updatedMin}min ${updatedSec}s`;
                            } else {
                                if(updatedMin > 0 ){
                                updatedSec = 59;
                                updatedMin = updatedMin - 1;

                                if(updatedMin < 1) {
                                    updatedHour = updatedHour - 1;
                                }

                                shutdownInformation.innerHTML = `Será desligado em ${hour}h ${updatedMin}min ${updatedSec}s`;
                                } else {
                                if(updatedHour < 1){
                                    shutdownInformation.innerHTML = `Será desligado em ${hour}h ${updatedMin}min ${updatedSec}s`;
                                }
                                }
                            }


                        }
                        

                }).catch(err => {
                    console.log(err);
                });
    }
};

/*Função para reiniciar o pc*/
async function restart(){

    var hour = document.getElementById('hoursForm').value;
    var min = document.getElementById('minutesForm').value;
    var sec = document.getElementById('secondsForm').value;
    

    actionInProgress = true;

    const timeToShutdown = hour * 3600 + min * 60 + sec * 1;

    if(hour == undefined || hour.length == 0 || min == undefined || min.length == 0 || sec == undefined || sec.length == 0){
        Toastify({
                        text: "Atenção: Informe o tempo para desligar",
                        className: "info",
                        style: {
                            background: "yellow",
                            color: "black"
                        }
                        }).showToast();
    } else {
        
        console.log(actionInProgress);

        await axios({method: 'get',url: `http://localhost:8080/restart/${timeToShutdown}`,}).then(function (response) {
                
            const shutdownInformation = document.getElementById('shutdownInformation');
            document.getElementById("cancelShutdownButton").disabled = false;

            var updatedSec = sec;
            var updatedMin = min;
            var updatedHour = hour;

            var interval = setInterval( decrement, 1000);

            function decrement(){

                if(updatedSec > 0) {
                    updatedSec = updatedSec - 1;
                
                    shutdownInformation.innerHTML = `Será reiniciado em ${hour}h ${updatedMin}min ${updatedSec}s`;
                } else {
                if(updatedMin > 0 ){
                    updatedSec = 59;
                    updatedMin = updatedMin - 1;

                    if(updatedMin < 1) {
                        updatedHour = updatedHour - 1;
                    }

                    shutdownInformation.innerHTML = `Será desligado em ${hour}h ${updatedMin}min ${updatedSec}s`;
                } else {
                    if(updatedHour < 1){
                        shutdownInformation.innerHTML = `Será desligado em ${hour}h ${updatedMin}min ${updatedSec}s`;
                    }
                }
                }


            }
                
        }).catch(err => {
            console.log(err);
        });
    }
};

function shutdownCancel(){

    location.reload();
    axios({method: 'get',url: `http://localhost:8080/cancel`,}).then(function (response) {

        const shutdownInformation = document.getElementById('shutdownInformation');
        shutdownInformation.innerHTML = '';

    }).catch(err => {
        console.log(err);
    });
};

function runPreset(time){

    if(time == 10){
        document.getElementById('hoursForm').value = "00";
        document.getElementById('minutesForm').value = 10;
        document.getElementById('secondsForm').value = "00";
    }

    if(time == 30){
        document.getElementById('hoursForm').value = "00";
        document.getElementById('minutesForm').value = 30;
        document.getElementById('secondsForm').value = "00";
    }

    if(time == 1){
        document.getElementById('hoursForm').value = "01";
        document.getElementById('minutesForm').value = "00";
        document.getElementById('secondsForm').value = "00";
    }
}


const shutdownButton = document.getElementById('shutdownButton').addEventListener('click', shutdown);
const restartButton = document.getElementById('restartButton').addEventListener('click', restart);
const cancelShutdownButton = document.getElementById('cancelShutdownButton').addEventListener('click', shutdownCancel);
           
  
</script>

</html>