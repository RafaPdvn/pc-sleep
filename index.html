<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>PC Sleep</title>

    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel='stylesheet' type='text/css' media='screen' href='main.css'>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@500&display=swap" rel="stylesheet">
    <link rel="shortcut icon" href="./images/favicon.ico" />
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
    <script src="./Backend/dist/easytimer.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</head>
<body style=" background: rgb(3,0,55);
background: linear-gradient(0deg, rgba(3,0,55,1) 0%, rgba(42,0,126,1) 50%, rgba(0,46,163,1) 100%);;">
    <div class="container">  
        <div class="main"> <br>  <br/>  <br/>
            <div class="title">
                <h1> PC Sleep </h1>
            </div>  
 
            <h3 id="subtitle">Insira o tempo para o computador desligar abaixo</h3> <br/>  <br/>

            <div class="timeFormContainer">

                <div class="form-outline timeFormContainer" style="width: 22rem;">
                    <input id = "hoursForm" min="0" max="20" type="number" id="typeNumber" class="form-control" value="00" />

                    <input id = "minutesForm" min="0" max="20" type="number" id="typeNumber" class="form-control"  value="30" />
                    
                    <input id = "secondsForm" min="0" max="20" type="number" id="typeNumber" class="form-control"  value="00"/>
     
                </div>

                <!-- <input id = "hoursForm" class = "timeForm" value="00" placeholder="" type="number" min="0" max="99"></input>  <br/>
                <input id = "minutesForm" class = "timeForm" value="30" placeholder="" type="number" min="0" max="59"></input>  <br/>
                <input id = "secondsForm" class = "timeForm" value="00" placeholder="" type="number" min="0" max="59"></input>  <br/> -->
                <br/>
            </div>

            <br/>

            <button id = "shutdownButton" class="btn btn-primary"> Agendar desligamento </button> <br/> 

            <button id = "cancelShutdownButton" class="btn btn-danger"> Cancelar desligamento </button>

            <div> <br/> 
                <p id = "shutdownInformation"></p>
            </div>

        </div>
    </div>

</body>



<script>

        async function shutdown(){

            var hour = document.getElementById('hoursForm').value;
            var min = document.getElementById('minutesForm').value;
            var sec = document.getElementById('secondsForm').value;

            const timeToShutdown = hour * 3600 + min * 60 + sec * 1;

            if(hour == undefined || hour.length == 0 || min == undefined || min.length == 0 || sec == undefined || sec.length == 0){
                alert('Informe o tempo para desligar')
            } else {

               await axios({
                        method: 'get',
                        url: `http://localhost:8080/shutdown/${timeToShutdown}`,
                        })
                        .then(function (response) {
                            
                            const shutdownInformation = document.getElementById('shutdownInformation');


                            
                                // for(var i = hour; i >= 0; i--){
                                //     for(var j = min; j >= 0; j--){
                                //         for(var k = sec; k >= 0; k--){    
                                //             shutdownInformation.innerHTML = `Será desligado em ${hour} hora(s), ${min} minuto(s) e ${sec} segundo(s)`;
                                //         }
                                //         sec = 59;
                                //     }
                                //     min = 59;
                                // }

                                var updatedSec = sec;
                                var updatedMin = min;
                                var updatedHour = hour;

                                var interval = setInterval( decrement, 1000);

                                function decrement(){

                                    if(updatedSec > 0) {
                                        updatedSec = updatedSec - 1;
                                     
                                        shutdownInformation.innerHTML = `Será desligado em ${hour}h ${updatedMin}min ${updatedSec}s`;
                                    } else {
                                      if(updatedMin > 0 ){
                                        updatedSec = 59;
                                        updatedMin = updatedMin - 1;

                                        if(updatedMin < 1) {
                                            updatedHour = updatedHour - 1;
                                        }

                                        shutdownInformation.innerHTML = `Será desligado em ${hour}h ${updatedMin}min ${updatedSec}s`;
                                      } else {
                                        if(updatedHour < 1){
                                            shutdownInformation.innerHTML = `Será desligado em ${hour}h ${updatedMin}min ${updatedSec}s`;
                                        }
                                      }
                                    }


                                }
                                  
    
                               // shutdownInformation.innerHTML = `Será desligado em ${hour} hora(s), ${min} minuto(s) e ${sec} segundo(s)`;

                        }).catch(err => {
                            console.log(err);
                        });
            }
        };

       

         function shutdownCancel(){

            location.reload();
             axios({
                method: 'get',
                url: `http://localhost:8080/cancel`,
                })
                .then(function (response) {
   
                    const shutdownInformation = document.getElementById('shutdownInformation');
                    shutdownInformation.innerHTML = '';

                }).catch(err => {
                    console.log(err);
                });
            };


            const shutdownButton = document.getElementById('shutdownButton').addEventListener('click', shutdown);
            const cancelShutdownButton = document.getElementById('cancelShutdownButton').addEventListener('click', shutdownCancel);
           

       


         
</script>

</html>